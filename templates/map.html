<div class="map-section">

  <script class="gpx" type="text/xml">
    %s
  </script>

  <div class="map">
  </div>

  <script type="text/javascript">
    var map = L.map(document.currentScript.parentElement.children[1]).setView([51.505, -0.09], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
	maxZoom: 19}).addTo(map)

    L.control.scale().addTo(map);

    // Trim to remove leading carriage return that breaks the xml parsing
    var gpx = document.currentScript.parentElement.children[0].innerHTML.trim()
    
    layer = omnivore.gpx.parse(gpx)
    layer.addTo(map);

    map.fitBounds(layer.getBounds());  
    </script>

</div>
